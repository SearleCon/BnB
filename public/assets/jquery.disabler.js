/*!
* jQuery Disabler
* Author: Doug Estep - Dayton Technology Group.
* Version 1.0.0
*
* API Documentation:
*   http://dougestep.com/dme/jquery-disabler-widget
*
* Depends:
*   jquery >= 1.7.0
*   jquery-ui widget factory >= 1.8.0
*
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*/
(function(e,t){var n="hasDisabler",r="disabler-ignore-readonly",i="disabler-hide-readonly",s="disabler-show-text-readonly",o="panels-date-picker",u="ui-state-disabled",a="disabler-read-only-text",f="disabler-read-only-display-as-text",l="disabler-read-only",c="disabler-hidden-inputs",h="disabler-anchor-href",p="disabler-saved-events",d="data-disabler-read-only-display";e.widget("dtg.disabler",{options:{disable:!1,readonly:!1,expression:"*:not(.disabler-ignore-readonly)"},_create:function(){this._initOptions(),this.options.disable&&this._setOption("disable",this.options.disable),this.options.readonly&&this._setOption("readonly",this.options.readonly),this.element.hasClass(n)||this.element.addClass(n)},_initOptions:function(){this.options.disable=this._ensureBoolean(this.options.disable),this.options.readonly=this._ensureBoolean(this.options.readonly)},_ensureBoolean:function(e){var t=!1;if(this._isNotNullAndNotUndefined(e)){var n=(new String(e)).toLowerCase();t=n=="true"}return t},_setOption:function(e,t){this._initOptions(),this.options[e]=t;var n=this.element.attr("id");switch(e){case"disable":this._doDisable(n,t);break;case"readonly":this.readOnly(n,this.options.readonly)}},_getId:function(t){return this._isNullOrUndefined(t)&&(t=this.element.attr("id")),this._isNotNullAndNotUndefined(t)&&(t=e.trim(t),t.length==0&&(t=null)),t},enable:function(e){e=this._getId(e);if(this._isNullOrUndefined(e))return;this._doDisable(e,!1)},disable:function(e){e=this._getId(e);if(this._isNullOrUndefined(e))return;this._doDisable(e,!0)},_doDisable:function(t,n){var r=this._escape(t),i=e.Event("beforeDisable");this._trigger("beforeDisable",i,{containerId:r,disabling:n,element:this.element});if(i.isDefaultPrevented())return;this._readOnlyForDisable(t,n),this.options.disable=n;var s=e.Event("afterDisable");this._trigger("afterDisable",s,{containerId:r,disabling:n,element:this.element}),this.options.disable=n},_readOnlyForDisable:function(e,t){e=this._getId(e);if(this._isNullOrUndefined(e))return;t=this._defaultReadOnlyFlag(t),this._doReadOnly(e,t,!0)},readOnly:function(e,t){e=this._getId(e);if(this._isNullOrUndefined(e))return;t=this._defaultReadOnlyFlag(t),this._doReadOnly(e,t,!1)},_defaultReadOnlyFlag:function(e){return e==t&&(e=!0),e},_doReadOnly:function(n,r,s){var o=this._escape(n),u=e.Event("beforeReadOnly");this._trigger("beforeReadOnly",u,{containerId:o,readOnlyFlag:r,disabling:s,element:this.element});if(u.isDefaultPrevented()||r==t)return;var f=[],l=this._formatSelectorForContainerId(o),c=e(l);if(c.length==0)return;this._doReadOnlyIteration(c,r,f,s);var h=this,l=this.options.expression+", span."+a+", ."+i;c.find(l).each(function(n){var i=e(this),u=e.Event("readOnlyIteration");h._trigger("readOnlyIteration",u,{input:i,index:n,containerId:o,readOnlyFlag:r,disabling:s,element:h.element});if(u.isDefaultPrevented())return!0;var a=i.data("disabler");if(a!=t)return!0;h._doReadOnlyIteration(i,r,f,s)}),this._processHiddenInputsOnReadOnly(o,r,f),this.options.readonly=r;var p=e.Event("afterReadOnly");this._trigger("afterReadOnly",p,{containerId:o,readOnlyFlag:r,disabling:s,element:this.element})},_whatTypeAmI:function(e){var n=e.attr("type");return n==t&&(e[0]==t?n="":n=e[0].tagName),n.toLowerCase()},_doReadOnlyIteration:function(e,t,n,r){t?this._turnReadOnlyOn(e,n,r):this._turnReadOnlyOff(e)},_turnReadOnlyOn:function(n,a,f){if(n.data(l)!=t)return;if(n.attr("readonly")!=t||n.attr("disabled")!=t)return;if((n.hasClass("hasDatepicker")||n.hasClass(o))&&n.datepicker("option","disabled"))return;n.data(l,!0);if(n.hasClass(r))return;var c=this._whatTypeAmI(n);if(!f){if(n.hasClass(i)){this._disableEvents(n),a.push(n),n.hide();return}if(n.hasClass(s)){this._disableEvents(n),this._showTextReadOnly(n,c);return}}var h=e.Event("turnReadOnlyOn");this._trigger("turnReadOnlyOn",h,n);if(h.isDefaultPrevented())return;n.data("accordion")==t&&(n.data("progressbar")!=t?n.progressbar("disable"):n.data("slider")!=t?n.slider("disable"):n.data("spinner")!=t?n.spinner("disable"):n.data("tabs")!=t?n.tabs("disable"):n.data("menu")!=t?n.menu("disable"):n.data("datapicker")||n.hasClass(o)?n.datepicker("disable"):c=="a"?this._disableLink(n):c=="submit"||c=="button"||c=="label"?n.hasClass("ui-button")?n.button("disable"):c=="label"?n.addClass(u):n.attr("disabled","true"):c=="select"||c=="checkbox"||c=="radio"?(this._disableEvents(n),n.attr("disabled","true")):c=="text"||c=="textarea"?(n.attr("readonly","readonly"),n.attr("disabled","true")):this._disableEvents(n))},_showTextReadOnly:function(n,r){var i=e.Event("showTextReadOnly");this._trigger("showTextReadOnly",i,n);if(i.isDefaultPrevented())return;var s=this,o="",u="";if(r=="a")u=this._getTextForInput(n,n.text());else if(r=="text"||r=="textarea")u=this._getTextForInput(n,n.val());else if(r=="radio"||r=="checkbox")n.attr("checked")!=t&&(u=this._getTextForInput(n,n.val()));else if(r=="select"){var c=[];n.find("option:selected").each(function(t){var n=e(this),r=s._getTextForSelectOption(n);c.push(r)}),u=c.join(", ")}n.wrap('<span class="'+a+'"></span>'),n.parent("span."+a).data(l,!0);var h="";e.trim(u).length==0&&(h='style="display: none; "'),n.parent().after('<span class="'+f+'" '+h+">"+u+"</span>"),n.hide()},_getTextForInput:function(e,n){var r=e.attr(d);return r==t&&(r=n),overrideText=e.parent().attr(d),overrideText!=t&&(r=overrideText),r},_getTextForSelectOption:function(e){var n=e.attr(d);return n==t&&(n=e.text()),n},_turnReadOnlyOff:function(n){if(n.data(l)==t)return;n.removeData(l);if(n.hasClass(a)){var r=e.Event("undoShowTextReadOnly");this._trigger("undoShowTextReadOnly",r,n);if(!r.isDefaultPrevented()){var i=n.next("span."+f);i.remove();var s=n.children();s.unwrap(),this._enableEvents(s),s.show()}}else{var c=e.Event("turnReadOnlyOff");this._trigger("turnReadOnlyOff",c,n);if(!c.isDefaultPrevented()){var h=this._whatTypeAmI(n);n.data("accordion")==t&&(n.data("progressbar")!=t?n.progressbar("enable"):n.data("slider")!=t?n.slider("enable"):n.data("spinner")!=t?n.spinner("enable"):n.data("tabs")!=t?n.tabs("enable"):n.data("menu")!=t?n.menu("enable"):n.data("datapicker")||n.hasClass(o)?n.datepicker("enable"):h=="a"?this._enableLink(n):h=="submit"||h=="button"||h=="label"?n.hasClass("ui-button")?n.button("enable"):h=="label"?n.removeClass(u):n.removeAttr("disabled"):h=="select"||h=="checkbox"||h=="radio"?(this._enableEvents(n),n.removeAttr("disabled")):h=="text"||h=="textarea"?(n.removeAttr("readonly"),n.removeAttr("disabled")):this._enableEvents(n))}}},_processHiddenInputsOnReadOnly:function(n,r,i){var s=this._escapeValue(this.element.attr("id"));if(r){i.length>0&&e("#"+s).data(c,i);var o=e.Event("processHiddenInputsReadOnly");this._trigger("processHiddenInputsReadOnly",o,{containerId:s,hiddenInput:a,element:this.element})}else{i=e("#"+s).data(c);if(i!=t){for(var u=0;u<i.length;u++){var a=i[u];this._enableEvents(a),a.show();var f=e.Event("processHiddenInputsNotReadOnlyIteration");this._trigger("processHiddenInputsNotReadOnlyIteration",f,{containerId:s,hiddenInput:a,element:this.element})}e("#"+s).removeData(c)}}},_disableLink:function(e){this._disableEvents(e);var n=e.attr("href");n!=t&&(e.data(h,n),e.attr("href","#")),e.on("click",function(e){e.preventDefault()}),e.addClass(u)},_disableEvents:function(n){var r=e.Event("disableEvents");this._trigger("disableEvents",r,n);if(r.isDefaultPrevented())return;var i=this.widgetEventPrefix,s=n.data("events");if(s!=t){var o=[];e.each(s,function(r,s){e.each(s,function(e){var u=s[e];if(u!=t){var a={eventName:r,handler:u};r.indexOf(i)<0&&(o.push(a),n.unbind(r))}})}),n.data(p,o)}},_enableLink:function(e){e.unbind(),this._enableEvents(e);var n=e.data(h);n!=t&&(e.attr("href",n),e.removeData(h)),e.removeClass(u)},_enableEvents:function(n){var r=e.Event("enableEvents");this._trigger("enableEvents",r,n);if(r.isDefaultPrevented())return;var i=n.data(p);i!=t&&e.each(i,function(e){var t=i[e],r=t.eventName,s=t.handler;n.on(r,s)})},_escape:function(e){return e==t&&(e=this.element.attr("id")),this._escapeValue(e)},_escapeValue:function(e){return e=e.replace(/\+/g,"\\+"),e=e.replace(/\\/g,"\\"),e=e.replace(/\//g,"\\/"),e=e.replace(/!/g,"\\!"),e=e.replace(/"/g,'\\"'),e=e.replace(/#/g,"\\#"),e=e.replace(/\$/g,"\\$"),e=e.replace(/%/g,"\\%"),e=e.replace(/&/g,"\\&"),e=e.replace(/'/g,"\\'"),e=e.replace(/\(/g,"\\("),e=e.replace(/\)/g,"\\)"),e=e.replace(/\*/g,"\\*"),e=e.replace(/,/g,"\\,"),e=e.replace(/\./g,"\\."),e=e.replace(/:/g,"\\:"),e=e.replace(/;/g,"\\;"),e=e.replace(/\?/g,"\\?"),e=e.replace(/@/g,"\\@"),e=e.replace(/\[/g,"\\["),e=e.replace(/\]/g,"\\]"),e=e.replace(/\^/g,"\\^"),e=e.replace(/`/g,"\\`"),e=e.replace(/\{/g,"\\{"),e=e.replace(/\}/g,"\\}"),e=e.replace(/\|/g,"\\|"),e=e.replace(/\~/g,"\\~"),e},_isNotNullAndNotUndefined:function(e){return e!=t&&e!=null},_isNullOrUndefined:function(e){return e==null||e==t},_formatSelectorForContainerId:function(e){var t=this._escapeValue(this.element.attr("id"));t==e&&(e=null);var n="#"+e+" ";return this._isNullOrUndefined(e)&&(n=""),n==""?n="#"+t:n="#"+t+" "+n,n+" "}}),e.extend(e.dtg.disabler,{version:"1.0.0"})})(jQuery);