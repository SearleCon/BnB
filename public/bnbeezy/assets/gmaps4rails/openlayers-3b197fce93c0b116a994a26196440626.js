(function(){Gmaps4Rails.Openlayers={},Gmaps4Rails.Openlayers.Shared={createPoint:function(e,t){return new OpenLayers.Geometry.Point(t,e)},createLatLng:function(e,t){return(new OpenLayers.LonLat(t,e)).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"))},createAnchor:function(e){return e===null?null:new OpenLayers.Pixel(e[0],e[1])},createSize:function(e,t){return new OpenLayers.Size(e,t)},createLatLngBounds:function(){return new OpenLayers.Bounds}}}).call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Gmaps4Rails.Openlayers.Map=function(e){function n(e,t){var n,r,i;this.controller=t,n=this.setConf(),this.options=this.mergeObjects(e,n),i={center:this.createLatLng(this.options.center_latitude,this.options.center_longitude),zoom:this.options.zoom},r=this.mergeObjects(e.raw,i),this.serviceObject=new OpenLayers.Map(this.options.id,r),this.serviceObject.addLayer(new OpenLayers.Layer.OSM)}return t(n,e),n.include(Gmaps4Rails.Interfaces.Map),n.include(Gmaps4Rails.Map),n.include(Gmaps4Rails.Openlayers.Shared),n.include(Gmaps4Rails.Configuration),n.prototype.CONF={disableDefaultUI:!1,disableDoubleClickZoom:!1,type:"ROADMAP",mapTypeControl:null},n.prototype.extendBoundsWithMarker=function(e){return this.boundsObject.extend(this.createLatLng(e.lat,e.lng))},n.prototype.extendBoundsWithPolyline=function(e){},n.prototype.extendBoundsWithPolygon=function(e){},n.prototype.extendBoundsWithCircle=function(e){},n.prototype.extendBound=function(e){},n.prototype.fitBounds=function(){return this.serviceObject.zoomToExtent(this.boundsObject,!0)},n.prototype.adaptToBounds=function(){return this.fitBounds()},n.prototype.centerMapOnUser=function(e){return this.serviceObject.setCenter(e)},n}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Gmaps4Rails.Openlayers.Marker=function(e){function n(e,t){this.controller=t,this.controller._createMarkersLayer(),this._createMarkerStyle(e),this._isBasicMarker(e)?this._styleForBasicMarker(e):this._styleForCustomMarker(e),this.serviceObject=new OpenLayers.Feature.Vector(this.createPoint(e.lat,e.lng),null,this.style_mark),this.serviceObject.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.controller.markersLayer.addFeatures([this.serviceObject])}return t(n,e),n.include(Gmaps4Rails.Interfaces.Marker),n.include(Gmaps4Rails.Openlayers.Shared),n.include(Gmaps4Rails.Marker.Instance),n.extend(Gmaps4Rails.Marker.Class),n.extend(Gmaps4Rails.Configuration),n.prototype.createInfoWindow=function(){if(this.description!=null)return this.serviceObject.infoWindow=this.description},n.prototype.isVisible=function(){return!0},n.prototype._isBasicMarker=function(e){return e.marker_picture==null},n.prototype._createMarkerStyle=function(e){return this.style_mark=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),this.style_mark.fillOpacity=1,this.style_mark.graphicTitle=e.marker_title},n.prototype._styleForBasicMarker=function(e){return this.style_mark.graphicHeight=30,this.style_mark.externalGraphic="http://openlayers.org/dev/img/marker-blue.png"},n.prototype._styleForCustomMarker=function(e){this.style_mark.graphicWidth=e.marker_width,this.style_mark.graphicHeight=e.marker_height,this.style_mark.externalGraphic=e.marker_picture,e.marker_anchor!=null&&(this.style_mark.graphicXOffset=e.marker_anchor[0],this.style_mark.graphicYOffset=e.marker_anchor[1]);if(e.shadow_picture!=null){this.style_mark.backgroundGraphic=e.shadow_picture,this.style_mark.backgroundWidth=e.shadow_width,this.style_mark.backgroundHeight=e.shadow_height;if(e.shadow_anchor!=null)return this.style_mark.backgroundXOffset=e.shadow_anchor[0],this.style_mark.backgroundYOffset=e.shadow_anchor[1]}},n}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Gmaps4Rails.Openlayers.Polyline=function(e){function n(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;this.controller=t,this.controller._createPolylinesLayer(),u=[];for(h=0,p=e.length;h<p;h++)r=e[h],r===e[0]&&(a=r.strokeColor||this.controller.polylines_conf.strokeColor,f=r.strokeOpacity||this.controller.polylines_conf.strokeOpacity,l=r.strokeWeight||this.controller.polylines_conf.strokeWeight,n=r.clickable||this.controller.polylines_conf.clickable,c=r.zIndex||this.controller.polylines_conf.zIndex),r.lat!=null&&r.lng!=null&&(i=new OpenLayers.Geometry.Point(r.lng,r.lat),u.push(i));s=new OpenLayers.Geometry.LineString(u),o={strokeColor:a,strokeOpacity:f,strokeWidth:l},this.serviceObject=new OpenLayers.Feature.Vector(s,null,o),this.serviceObject.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),this.controller.polylinesLayer.addFeatures([this.serviceObject])}return t(n,e),n.include(Gmaps4Rails.Interfaces.Basic),n.include(Gmaps4Rails.Openlayers.Shared),n.extend(Gmaps4Rails.Polyline.Class),n.extend(Gmaps4Rails.Configuration),n.prototype.isVisible=function(){return!0},n}(Gmaps4Rails.Common)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};this.Gmaps4RailsOpenlayers=function(e){function n(){n.__super__.constructor.apply(this,arguments),this.markersControl=null,this.markersLayer=null,this.polylinesLayer=null}return t(n,e),n.include(Gmaps4Rails.Openlayers.Shared),n.prototype.getModule=function(){return Gmaps4Rails.Openlayers},n.prototype.createClusterer=function(e){var t,n;return n=new OpenLayers.Style(this._clustererOptions,this._clustererFunctions),t=new OpenLayers.Strategy.Cluster,this._clearMarkersLayer(),this.clusterLayer=new OpenLayers.Layer.Vector("Clusters",{strategies:[t],styleMap:new OpenLayers.StyleMap({"default":n,select:{fillColor:"#8aeeef",strokeColor:"#32a8a9"}})}),this.getMapObject().addLayer(this.clusterLayer),this.clusterLayer.addFeatures(e),this.clusterLayer},n.prototype.clearClusterer=function(){return this.clusterLayer!=null&&this.getMapObject().getLayer(this.clusterLayer.id)!=null&&this.getMapObject().removeLayer(this.markerClusterer),this.clusterLayer=null},n.prototype.clearMarkers=function(){return this._clearMarkersLayer(),this.clearClusterer(),this.markers=[]},n.prototype._createPolylinesLayer=function(){if(this.polylinesLayer!=null)return;return this.polylinesLayer=new OpenLayers.Layer.Vector("Polylines",null),this.polylinesLayer.events.register("featureselected",this.polylinesLayer,this._onFeatureSelect),this.polylinesLayer.events.register("featureunselected",this.polylinesLayer,this._onFeatureUnselect),this.polylinesControl=new OpenLayers.Control.DrawFeature(this.polylinesLayer,OpenLayers.Handler.Path),this.getMapObject().addLayer(this.polylinesLayer),this.getMapObject().addControl(this.polylinesControl)},n.prototype._createMarkersLayer=function(){if(this.markersLayer!=null)return;return this.markersLayer=new OpenLayers.Layer.Vector("Markers",null),this.getMapObject().addLayer(this.markersLayer),this.markersLayer.events.register("featureselected",this.markersLayer,this._onFeatureSelect()),this.markersLayer.events.register("featureunselected",this.markersLayer,this._onFeatureUnselect()),this.markersControl=new OpenLayers.Control.SelectFeature(this.markersLayer),this.getMapObject().addControl(this.markersControl),this.markersControl.activate()},n.prototype._clearMarkersLayer=function(){return this.markersLayer!=null&&this.getMapObject().getLayer(this.markersLayer.id)!=null&&this.getMapObject().removeLayer(this.markersLayer),this.markersLayer=null},n.prototype._onFeatureSelect=function(){var e;return e=this,function(t){var n,r;return n=t.feature,r=new OpenLayers.Popup.FramedCloud("featurePopup",n.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(300,200),n.infoWindow,null,!0,e._onPopupClose(e,n)),n.popup=r,r.feature=n,e.getMapObject().addPopup(r)}},n.prototype._onFeatureUnselect=function(){var e;return e=this,function(t){var n;n=t.feature;if(n.popup!=null)return e.getMapObject().removePopup(n.popup),n.popup.destroy(),n.popup=null}},n.prototype._onPopupClose=function(e,t){return function(){return e.markersControl.unselect(t)}},n.prototype._clustererFunctions={context:{width:function(e){var t;return(t=e.cluster)!=null?t:{2:1}},radius:function(e){var t;return t=2,e.cluster&&(t=e.cluster.length+10),t},label:function(e){return e.cluster?e.cluster.length:""}}},n.prototype._clustererOptions={pointRadius:"${radius}",fillColor:"#ffcc66",fillOpacity:.8,strokeColor:"#cc6633",strokeWidth:"${width}",label:"${label}"},n}(Gmaps4Rails.BaseController)}.call(this),function(){}.call(this);